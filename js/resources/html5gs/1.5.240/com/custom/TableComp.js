var TableComp=function(){var c,l,u,a,r,f,v={id:"",width:300,height:300,maxRows:7,scrollerWidth:27,scrollerHandleWidth:18,scrollerHandleHeight:20,scrollerDisplay:!0,fontSize:"1em",emdash:!1,headingAlign:"center",bodyAlign:"center",barHeight:5,showHeader:!0,borderWidth:1,decimalAlign:!1,rowsCss:[],colsCss:[],visible:!0,refreshScroller:!0,nanDecimalAlign:!1,cols:[{label:"COLUMN 1",width:50,border:"2px solid #A7A7A7",bg:"#F4F4F4"},{label:"COLUMN 2",width:50,border:"2px solid #A7A7A7",bg:"#F4F4F4"}],setable:!1,caption:"Table",getTableHeader:!0},s=this,h=new Array,x=new Array,m=new Array,w=0;this.init=function(e){for(var t in e)v[t]=e[t];v.x=globalResizeCalc(v.x),v.y=globalResizeCalc(v.y),v.width=globalResizeCalc(v.width),v.height=globalResizeCalc(v.height),v.scrollerHandleWidth=globalResizeCalc(v.scrollerHandleWidth),v.scrollerHandleHeight=globalResizeCalc(v.scrollerHandleHeight),v.borderWidth=globalResizeCalc(v.borderWidth),v.headerHeight&&(v.headerHeight=globalResizeCalc(v.headerHeight),v.height=v.height-v.headerHeight),v.borderWidth<1&&(v.borderWidth=1);var i=document.createElement("div");v.target?v.target.append(i):$("body").append(i),v.target=$(i),0==v.visible&&v.target.css("display","none"),v.index&&v.target.css("z-index",v.index),v.title&&v.target.attr("p_title",GCTConv(v.title)),v.scrollerDisplay?(v.scrollerWidth=globalResizeCalc(v.scrollerWidth),v.width-=v.scrollerWidth):v.scrollerWidth=0,v.target.css({position:"absolute",left:v.x+"px",top:v.y+"px",width:v.width+"px",height:v.height+"px"}),r=document.createElement("div"),function(){if(v.columnBg)for(var e=new Array,t=v.height/(v.maxRows+1),i=0;i<v.cols.length;i++){e[i]=document.createElement("div"),v.target.append(e[i]);var l=v.width*parseInt(v.cols[i].width)/100;$(e[i]).css({width:l+"px",height:v.height-t-globalResizeCalc(2)+"px",background:v.cols[i].cbg,float:"left"})}c=document.createElement("div"),f=document.createElement("div"),v.target.append(f),v.target.append(c),$(c).addClass("ntable").attr("id",v.id+"_table"),$(c).css({position:"absolute",left:"0px",top:"0px",width:Math.round(v.width)+"px",height:v.height+"px"}).attr({cellpadding:0,cellspacing:0}),$(f).css({position:"absolute",left:"0px",top:"0px",opacity:0});for(var t=v.height/(v.maxRows+1),a=!1,i=0;i<=v.maxRows+1;i++){var r=0;x[i]=new Array,h[i]=document.createElement("div"),$(h[i]).addClass("ntr"),$(c).append(h[i]);for(var s=0;s<v.cols.length;s++){void 0!==v.cols[s].barColor&&(a=!0);var o=document.createElement("div");if(x[i][s]=o,x[i][s]=document.createElement("div"),$(x[i][s]).addClass("ntd"),o=x[i][s],$(h[i]).append(x[i][s]),$(o).css({background:v.cols[s].bg,"border-left":v.cols[s].border,"border-right":v.cols[s].border,overflow:"hidden"}),0==i&&$(x[i][s]).css({"border-top":v.cols[s].border,"border-bottom":v.cols[s].border}),i==v.maxRows+1?$(x[i][s]).css({"border-bottom":v.cols[s].border}):$(x[i][s]).css({}),$(x[i][s]).css({overflow:"hidden",display:"table-cell","font-size":v.fontSize,"text-align":"center","vertical-align":"middle",cursor:"default",background:v.cols[s].bg,"border-left":v.cols[s].border,"border-right":v.cols[s].border}),s!=v.cols.length-1){var l=v.width*v.cols[s].width/100;$(x[i][s]).css({width:l+"px",height:t}),$(o).css({width:l+"px"}),r+=l}else $(x[i][s]).css({width:v.width-r+"px",height:t}),$(o).css({width:v.width-r+"px"});if(i<2){$(o).css({border:v.cols[s].border}),$(x[i][s]).css({"font-weight":"bold","text-align":v.headingAlign}),v.headerHeight&&$(x[0][s]).css({height:v.headerHeight}),v.leftPadding&&$(x[i][s]).css({"padding-left":v.leftPadding}),v.rightPadding&&$(x[i][s]).css({"padding-right":v.rightPadding});var n=String(v.cols[s].label).replace(/-/g,"–");if(-1!=n.indexOf("\\begin{equation}"))if(v.katex)printKatex($(x[i][s]),n);else{var d=document.createElement("div");$(x[i][s]).html(d),$(d).attr("id",v.id+"_"+i+"_"+s+"_div").css({display:"inline-block"}).html(n)}else $(x[i][s]).html(n)}else $(x[i][s]).css({"text-align":v.bodyAlign}),v.leftPadding&&$(x[i][s]).css({"padding-left":v.leftPadding}),v.rightPadding&&$(x[i][s]).css({"padding-right":v.rightPadding});i==v.maxRows+1&&$(o).css({"border-bottom":v.cols[s].border}),$(o).css({"border-width":v.borderWidth+"px"}).attr("id",v.id+"_"+i+"_"+s)}}if(a)for(var s=0;s<x[1].length;s++)void 0!==v.cols[s].barColor&&$(x[1][s]).css({background:v.cols[s].barColor,height:globalResizeCalc(v.barHeight)+"px"}).html("");else{$(h[1]).remove();for(var s=0;s<x[1].length;s++)$(x[1][s]).remove()}x.splice(1,1),h.splice(1,1)}(),function(){v.scrollerDisplay&&(l=document.createElement("div"),v.target.append(l),$(l).css({position:"absolute",left:v.width+"px",top:"0px",width:v.scrollerWidth+"px",height:$(c).outerHeight(!0)+"px",background:"#E5E5E5","box-shadow":"2px 2px 10px rgba(0,0,0,0.5) inset"}),a=document.createElement("div"),$(l).append(a),$(a).css({position:"absolute",left:globalResizeCalc(5)+"px",top:globalResizeCalc(5)+"px",width:v.scrollerWidth-globalResizeCalc(10)+"px",height:parseInt($(l).css("height"))-globalResizeCalc(10)+"px"}),u=document.createElement("div"),$(a).append(u),$(u).css({position:"absolute",left:"0px",top:"0px",width:v.scrollerWidth-globalResizeCalc(10)+"px",height:globalResizeCalc(39)+"px",background:"#FFFFFF","background-size":globalResizeCalc(10)+"px "+globalResizeCalc(17)+"px","background-position":"center","box-shadow":"2px 2px 5px rgba(0,0,0,0.5)",display:"none"}).attr("p_title",GetGlobalTooltip("tooltip","tablescroll")),$(u).addClass("commongrab"),$(u).draggable({containment:"parent",drag:g}),BrowserDetect.any()?$(u).unbind("touchstart",p).bind("touchstart",p).unbind("touchend",p).bind("touchend",p):$(u).unbind("mousedown",p).bind("mousedown",p));if(!v.showHeader){$(h[0]).hide();for(var e=0;e<x[1].length;e++)$(x[1][e]).css({"border-top":v.cols[e].border,"border-width":v.borderWidth+"px"});d()}}(),s.refreshTable()},this.addEventListener=function(e,t){v[e]=t};var o=v.visible;this.show=function(){n&&(o=!0,v.target.show(),y(),v.isShown&&v.isShown({show:!0}))},this.hide=function(){o=!1,v.target.hide(),v.isShown&&v.isShown({show:!1})},this.getIsvisible=function(){return o},this.addData=function(e){m.push(e),i(),d(),this.setLastIndex()},this.addWholeData=function(e){m=e,i(),d(),this.setLastIndex()},this.clearData=function(){m=new Array,w=0,v.resetToTop&&(w=0,$(u).css("top","0px")),d()},this.getTable=function(){$("body").append(r),$(r).css("opacity",0),$(r).attr("printdiv",!0);var e=new Array;if(e[0]=new Array,v.showHeader)for(var t=0;t<v.cols.length;t++)$(r).html(v.cols[t].label),e[0].push($(r).text());if(0<m.length){for(t=0;t<m.length;t++){var i=v.showHeader?t+1:t;e[i]=new Array;for(var l=0;l<m[t].length;l++)$(r).html(null!=m[t][l]?m[t][l]:""),e[i].push($(r).text())}return $(r).remove(),e}return $(r).remove(),!1},this.updateHeaderLabel=function(e){for(var t=0;t<x[0].length;t++)v.cols[t].label=String(e[t]).replace(/-/g,"–"),$(x[0][t]).html(String(e[t]).replace(/-/g,"–"))},this.getCellData=function(e,t,i){if(x[e+1][t])return i?$(x[e+1][t]).text():$(x[e+1][t]).html()},this.setCellData=function(e,t,i){x[e+1][t]&&(e+1==0&&(v.cols[t].label=String(i).replace(/-/g,"–")),$(x[e+1][t]).html(String(i).replace(/-/g,"–")))},this.setCellStyle=function(e,t,i){x[e+1][t]&&$(x[e+1][t]).css(i)},this.setLastIndex=function(){if("none"!=$(u).css("display")&&v.scrollerDisplay){var e=parseInt($(a).css("height"))-parseInt($(u).css("height"));e=e<0?0:e,$(u).css("top",e),g()}},this.getScrollIndex=function(){return w},this.setScrollIndex=function(e){if(null!=e&&e<m.length){w=e;var t=parseInt($(a).css("height"))-parseInt($(u).css("height")),i=w/(m.length-v.maxRows)*t;i=i<0?0:i,$(u).css("top",i),d()}},this.refreshTable=function(){!function(){for(var e=1;e<v.maxRows+1;e++){var t=new Object;if(v.rowsCss[e])for(var i in v.rowsCss[e])t[i]=v.rowsCss[e][i];for(var l=0;l<v.cols.length;l++){if(v.colsCss[l])for(var a in v.colsCss[l])t[a]=v.colsCss[l][a];(v.colsCss[l]||v.rowsCss[e])&&$(x[e][l]).css(t)}}}(),d(),y()},this.getColumn=function(){var e=new Array;if(e[0]=new Array,v.showHeader)for(var t=0;t<v.cols.length;t++)$(r).html(v.cols[t].label),e[0].push($(r).text().trim());if(0<m.length)for(t=0;t<m.length;t++){var i=v.showHeader?t+1:t;e[i]=new Array;for(var l=0;l<m[t].length;l++)$(r).html(null!=m[t][l]?m[t][l]:""),e[i].push(isNaN($(r).text())?$(r).text():""==$(r).text()||" "==$(r).text()?"N/A":1*$(r).text())}return e},this.getter=function(){var e=new Object;e.caption=v.caption?v.caption:v.id,e.common=!0,e.componentname="TableComp",v.tableGetterEvent&&v.tableGetterEvent();var t={},i=s.getColumn();t.column=v.cols.length,t.row=i.length-1;var l=0;v.getTableHeader&&v.showHeader&&(t.tableHeader=i[0],l=1),t.values=[];for(var a=l;a<i.length;a++)t.values.push(i[a]);return e.values=t,e.settable=!1,e.visible=getterSetter.isFromInit?o:n,e},this.getGetterData=function(){return null!=t.componentname?t:s.getter()};var t={},n=!0;function i(){if(null!=v.maxLimit)for(;m.length>v.maxLimit;)m.splice(0,1)}function y(){if(v.scrollerDisplay){var e=document.createElement("div");$("body").append(e),$(e).css({position:"absolute",left:"0px",top:"0px",opacity:0});var t=v.target.parent();$(l).css({height:$(c).outerHeight(!0)+"px"}),$(a).css({height:parseInt($(l).css("height"))-globalResizeCalc(10)+"px"}),$(t).append(v.target),$(e).remove()}}function d(){$(f).empty();for(var e=1,l=[],t=1;t<x.length;t++)for(var i=0;i<x[t].length;i++)$(x[t][i]).html("");for(var a=w;a<m.length;a++)if(x[e]){for(var r=0;r<x[e].length;r++){if(-1!=(h=String(m[a][r])).indexOf("\\begin{equation}"))if(v.katex)printKatex($(x[e][r]),h),$(".katex").css("font-weight",v.bold);else{var s=document.createElement("div"),o=String(m[a][r]).replace(/-/g,"–");$(f).append(s);var n=v.id+"_"+e+"_"+r+"_div";$("#"+n).remove(),$(s).attr("id",n).css({display:"inline-block",opacity:0}).attr("parentName",$(x[e][r]).attr("id")),l.push(n);var d=MathJax.Hub.getAllJax(n)[0],c=d?["Text",d,o]:["Typeset",MathJax.Hub,n];d||($(s).html(o),MathJax.Hub.Queue(c,v.id+"_table",function(){for(var e in l)if(1!=$("#"+l[e]).css("opacity")&&0<$("#"+l[e]+" > div.MathJax_Display").length){var t=$("#"+l[e]).clone();$(t).css("opacity",1),$("#"+$(t).attr("parentName")).empty().append(t),$(t).removeAttr("id"),0}var i=$(s).children(".MathJax_Display");i&&i.css("text-align","center")}))}else{var h=String(m[a][r]).replace(/-/g,"–");if(v.decimalAlign){var g,p,b=(parseFloat(x[e][r].style.width)-1)/2;isNaN(m[a][r])&&!v.nanDecimalAlign||(-1!=h.indexOf(".")?(g=h.split("."),p="."):(g=[h,""],p="<span style='opacity:0;'>.</span>"),h=v.decimalPadding?'<div style="display:table;"><div style="display:table-cell; text-align:right; width:'+b+'px;">'+g[0]+'</div><div style="display:table-cell; width:1px;">'+p+'</div><div style="display:table-cell; text-align:left; width:'+b+'px;">'+g[1]+"</div></div>":'<div style="display:table;"><div style="display:table-cell; text-align:right; width:'+b+'px;">'+g[0]+'</div><div style="display:table-cell; width:1px;">'+p+'</div><div style="display:table-cell; text-align:left;">'+g[1]+"</div></div>")}$(x[e][r]).html(h)}}e++}m.length>x.length-1?$(u).show():$(u).hide(),v.refreshScroller&&y()}function g(e,t){var i=parseInt($(u).css("top")),l=parseInt($(a).css("height"))-parseInt($(u).css("height"));w=Math.round((m.length-v.maxRows)/l*i),d()}function p(e){"mousedown"==e.type||"touchstart"==e.type?(focusOutInput(),addPointerGrabbing(!0),audioPlayerObj.playAudio("down"),BrowserDetect.any()||$(document).unbind("mouseup",p).bind("mouseup",p)):"mouseup"!=e.type&&"touchend"!=e.type||(audioPlayerObj.playAudio("up"),addPointerGrabbing(!1),$(document).unbind("mouseup",p))}this.setter=function(e){n!=e.visible&&((n=e.visible)?s.show():s.hide()),getterSetter.isFromReset&&(n=!0),t=e},this.getCaption=function(){return v.caption},this.isSetable=function(){return v.setable},this.getGSvisible=function(){return n},this.setGSvisible=function(e){n=e}};